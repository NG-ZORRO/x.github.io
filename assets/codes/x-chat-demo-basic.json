{"highlightCode":"<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Component<span class=\"token punctuation\">,</span> computed<span class=\"token punctuation\">,</span> model<span class=\"token punctuation\">,</span> signal <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> FormsModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/forms'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NzFlexModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'ng-zorro-antd/flex'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NxBubbleListItem<span class=\"token punctuation\">,</span> NxBubbleModule<span class=\"token punctuation\">,</span> NxBubbleRole <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'ng-zorro-x/bubble'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NxSenderModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'ng-zorro-x/sender'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> XAgent <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'ng-zorro-x/x-agent'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> XChat <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'ng-zorro-x/x-chat'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">Role</span> <span class=\"token operator\">=</span> <span class=\"token string\">'local'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'ai'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> sleep <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token builtin\">Promise</span></span><span class=\"token punctuation\">(</span>resolve <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Component</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  selector<span class=\"token operator\">:</span> <span class=\"token string\">'nx-demo-x-chat-basic'</span><span class=\"token punctuation\">,</span>\n  imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>FormsModule<span class=\"token punctuation\">,</span> NzFlexModule<span class=\"token punctuation\">,</span> NxBubbleModule<span class=\"token punctuation\">,</span> NxSenderModule<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token template-string\">template: <span class=\"token html\">`\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>nz-flex</span> <span class=\"token attr-name\">nzVertical</span> <span class=\"token attr-name\">nzGap</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>middle<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>nx-bubble-list</span> <span class=\"token attr-name\">[nxItems]</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>items()<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">[nxRoles]</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>roles<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>nx-sender</span> <span class=\"token attr-name\">[(ngModel)]</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>prompt<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">[nxLoading]</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>agent.isRequesting()<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">(nxSubmit)</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>request()<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>nz-flex</span><span class=\"token punctuation\">></span></span>\n  `</span></span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NxDemoXChatBasicComponent</span> <span class=\"token punctuation\">{</span>\n  prompt <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">model</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">readonly</span> mockSuccess <span class=\"token operator\">=</span> <span class=\"token function\">signal</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">readonly</span> roles<span class=\"token operator\">:</span> Record<span class=\"token operator\">&lt;</span>Role<span class=\"token punctuation\">,</span> NxBubbleRole<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    ai<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      placement<span class=\"token operator\">:</span> <span class=\"token string\">'start'</span><span class=\"token punctuation\">,</span>\n      typing<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> step<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> interval<span class=\"token operator\">:</span> <span class=\"token number\">20</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      avatar<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        icon<span class=\"token operator\">:</span> <span class=\"token string\">'user'</span><span class=\"token punctuation\">,</span>\n        style<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> background<span class=\"token operator\">:</span> <span class=\"token string\">'#fde3cf'</span> <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    local<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      placement<span class=\"token operator\">:</span> <span class=\"token string\">'end'</span><span class=\"token punctuation\">,</span>\n      avatar<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        icon<span class=\"token operator\">:</span> <span class=\"token string\">'user'</span><span class=\"token punctuation\">,</span>\n        style<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> background<span class=\"token operator\">:</span> <span class=\"token string\">'#87d068'</span> <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">readonly</span> agent <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XAgent<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> message<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">string</span><span class=\"token operator\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">request</span><span class=\"token operator\">:</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> message <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> onSuccess<span class=\"token punctuation\">,</span> onError <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">await</span> <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mockSuccess<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>success <span class=\"token operator\">=></span> <span class=\"token operator\">!</span>success<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">mockSuccess</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">onSuccess</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>`Mock success <span class=\"token keyword\">return</span><span class=\"token punctuation\">.</span> You said<span class=\"token operator\">:</span> $<span class=\"token punctuation\">{</span>message<span class=\"token punctuation\">}</span>`<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token function\">onError</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Mock request failed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">readonly</span> chat <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XChat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    agent<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>agent<span class=\"token punctuation\">,</span>\n    requestPlaceholder<span class=\"token operator\">:</span> <span class=\"token string\">'Waiting...'</span><span class=\"token punctuation\">,</span>\n    requestFallback<span class=\"token operator\">:</span> <span class=\"token string\">'Mock failed return. Please try again later.'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">readonly</span> items <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">computed</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>NxBubbleListItem<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>chat<span class=\"token punctuation\">.</span><span class=\"token function\">messages</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">,</span> status <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      key<span class=\"token operator\">:</span> id<span class=\"token punctuation\">,</span>\n      loading<span class=\"token operator\">:</span> status <span class=\"token operator\">===</span> <span class=\"token string\">'loading'</span><span class=\"token punctuation\">,</span>\n      role<span class=\"token operator\">:</span> status <span class=\"token operator\">===</span> <span class=\"token string\">'local'</span> <span class=\"token operator\">?</span> <span class=\"token string\">'local'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'ai'</span><span class=\"token punctuation\">,</span>\n      content<span class=\"token operator\">:</span> message\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> prompt <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>chat<span class=\"token punctuation\">.</span><span class=\"token function\">onRequest</span><span class=\"token punctuation\">(</span>prompt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>prompt<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n","rawCode":"import { Component, computed, model, signal } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\n\nimport { NzFlexModule } from 'ng-zorro-antd/flex';\n\nimport { NxBubbleListItem, NxBubbleModule, NxBubbleRole } from 'ng-zorro-x/bubble';\nimport { NxSenderModule } from 'ng-zorro-x/sender';\nimport { XAgent } from 'ng-zorro-x/x-agent';\nimport { XChat } from 'ng-zorro-x/x-chat';\n\ntype Role = 'local' | 'ai';\n\nconst sleep = (): Promise<void> => new Promise(resolve => setTimeout(resolve, 1000));\n\n@Component({\n  selector: 'nx-demo-x-chat-basic',\n  imports: [FormsModule, NzFlexModule, NxBubbleModule, NxSenderModule],\n  template: `\n    <nz-flex nzVertical nzGap=\"middle\">\n      <nx-bubble-list [nxItems]=\"items()\" [nxRoles]=\"roles\" />\n      <nx-sender [(ngModel)]=\"prompt\" [nxLoading]=\"agent.isRequesting()\" (nxSubmit)=\"request()\" />\n    </nz-flex>\n  `\n})\nexport class NxDemoXChatBasicComponent {\n  prompt = model<string>('');\n  readonly mockSuccess = signal(false);\n  readonly roles: Record<Role, NxBubbleRole> = {\n    ai: {\n      placement: 'start',\n      typing: { step: 5, interval: 20 },\n      avatar: {\n        icon: 'user',\n        style: { background: '#fde3cf' }\n      }\n    },\n    local: {\n      placement: 'end',\n      avatar: {\n        icon: 'user',\n        style: { background: '#87d068' }\n      }\n    }\n  };\n\n  readonly agent = new XAgent<string, { message: string }, string>({\n    request: async ({ message }, { onSuccess, onError }) => {\n      await sleep();\n      this.mockSuccess.update(success => !success);\n      if (this.mockSuccess()) {\n        onSuccess([`Mock success return. You said: ${message}`]);\n      }\n\n      onError(new Error('Mock request failed'));\n    }\n  });\n  readonly chat = new XChat({\n    agent: this.agent,\n    requestPlaceholder: 'Waiting...',\n    requestFallback: 'Mock failed return. Please try again later.'\n  });\n  readonly items = computed<NxBubbleListItem[]>(() =>\n    this.chat.messages().map(({ id, message, status }) => ({\n      key: id,\n      loading: status === 'loading',\n      role: status === 'local' ? 'local' : 'ai',\n      content: message\n    }))\n  );\n\n  request(): void {\n    const prompt = this.prompt();\n    this.chat.onRequest(prompt);\n    this.prompt.set('');\n  }\n}\n"}
