{"highlightCode":"<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Component<span class=\"token punctuation\">,</span> computed<span class=\"token punctuation\">,</span> linkedSignal<span class=\"token punctuation\">,</span> signal<span class=\"token punctuation\">,</span> TemplateRef<span class=\"token punctuation\">,</span> viewChild <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NzButtonModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'ng-zorro-antd/button'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NzSplitterModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'ng-zorro-antd/splitter'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NxThoughtChainModule<span class=\"token punctuation\">,</span> NxThoughtChainItem <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'ng-zorro-x/thought-chain'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> fromXStream <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'ng-zorro-x/x-stream'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> sipHeaders <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">'INVITE sip:[email protected] SIP/2.0\\n'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'Via: SIP/2.0/UDP [host];branch=123456\\n'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'Content-Type: application/sdp\\n\\n'</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> sdp <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">'v=0\\n'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'o=alice 2890844526 2890844526 IN IP4 [host]\\n'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'s=\\n'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'c=IN IP4 [host]\\n'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'t=0 0\\n'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'m=audio 49170 RTP/AVP 0\\n'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'a=rtpmap:0 PCMU/8000\\n'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'m=video 51372 RTP/AVP 31\\n'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'a=rtpmap:31 H261/90000\\n'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'m=video 53000 RTP/AVP 32\\n'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'a=rtpmap:32 MPV/90000\\n\\n'</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">mockReadableStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> ReadableStream <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ReadableStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">async</span> <span class=\"token function\">start</span><span class=\"token punctuation\">(</span>controller<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> chunk <span class=\"token keyword\">of</span> sipHeaders<span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span>sdp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">await</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\"><span class=\"token builtin\">Promise</span></span><span class=\"token punctuation\">(</span>resolve <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        controller<span class=\"token punctuation\">.</span><span class=\"token function\">enqueue</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">TextEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>chunk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      controller<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Component</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  selector<span class=\"token operator\">:</span> <span class=\"token string\">'nx-demo-x-stream-custom-protocol'</span><span class=\"token punctuation\">,</span>\n  imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>NzButtonModule<span class=\"token punctuation\">,</span> NzSplitterModule<span class=\"token punctuation\">,</span> NxThoughtChainModule<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token template-string\">template: <span class=\"token html\">`\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>nz-splitter</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>nz-splitter-panel</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">nz-button</span> <span class=\"token attr-name\">nzType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>primary<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">(click)</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>readStream()<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Mock Default Protocol - SSE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>nz-splitter-panel</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>nz-splitter-panel</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>nx-thought-chain</span> <span class=\"token attr-name\">[style.margin-inline-start.px]</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>16<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">[nxItems]</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>items()<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>nz-splitter-panel</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>nz-splitter</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ng-template</span> <span class=\"token attr-name\">#thoughtChainCard</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pre</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>code</span><span class=\"token punctuation\">></span></span>{{ content() }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>code</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pre</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ng-template</span><span class=\"token punctuation\">></span></span>\n  `</span></span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NxDemoXStreamCustomProtocolComponent</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">readonly</span> thoughtChainCard <span class=\"token operator\">=</span> <span class=\"token function\">viewChild</span><span class=\"token punctuation\">(</span><span class=\"token string\">'thoughtChainCard'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> read<span class=\"token operator\">:</span> TemplateRef <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">readonly</span> lines <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">signal</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">readonly</span> content <span class=\"token operator\">=</span> <span class=\"token function\">linkedSignal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    source<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>lines<span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">computation</span><span class=\"token operator\">:</span> lines <span class=\"token operator\">=></span> lines<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">readonly</span> items <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">computed</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>NxThoughtChainItem<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">lines</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length\n      <span class=\"token operator\">?</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token punctuation\">{</span>\n            title<span class=\"token operator\">:</span> <span class=\"token string\">'Mock Custom Protocol - Log'</span><span class=\"token punctuation\">,</span>\n            status<span class=\"token operator\">:</span> <span class=\"token string\">'success'</span><span class=\"token punctuation\">,</span>\n            icon<span class=\"token operator\">:</span> <span class=\"token string\">'tags'</span><span class=\"token punctuation\">,</span>\n            content<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">thoughtChainCard</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">readStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">fromXStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      readableStream<span class=\"token operator\">:</span> <span class=\"token function\">mockReadableStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      transformStream<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TransformStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token function\">transform</span><span class=\"token punctuation\">(</span>chunk<span class=\"token punctuation\">,</span> controller<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          controller<span class=\"token punctuation\">.</span><span class=\"token function\">enqueue</span><span class=\"token punctuation\">(</span>chunk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span>chunk <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>chunk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>lines<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>pre <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>pre<span class=\"token punctuation\">,</span> chunk<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n","rawCode":"import { Component, computed, linkedSignal, signal, TemplateRef, viewChild } from '@angular/core';\n\nimport { NzButtonModule } from 'ng-zorro-antd/button';\nimport { NzSplitterModule } from 'ng-zorro-antd/splitter';\n\nimport { NxThoughtChainModule, NxThoughtChainItem } from 'ng-zorro-x/thought-chain';\nimport { fromXStream } from 'ng-zorro-x/x-stream';\n\nconst sipHeaders = [\n  'INVITE sip:[email protected] SIP/2.0\\n',\n  'Via: SIP/2.0/UDP [host];branch=123456\\n',\n  'Content-Type: application/sdp\\n\\n'\n];\n\nconst sdp = [\n  'v=0\\n',\n  'o=alice 2890844526 2890844526 IN IP4 [host]\\n',\n  's=\\n',\n  'c=IN IP4 [host]\\n',\n  't=0 0\\n',\n  'm=audio 49170 RTP/AVP 0\\n',\n  'a=rtpmap:0 PCMU/8000\\n',\n  'm=video 51372 RTP/AVP 31\\n',\n  'a=rtpmap:31 H261/90000\\n',\n  'm=video 53000 RTP/AVP 32\\n',\n  'a=rtpmap:32 MPV/90000\\n\\n'\n];\n\nfunction mockReadableStream(): ReadableStream {\n  return new ReadableStream({\n    async start(controller) {\n      for (const chunk of sipHeaders.concat(sdp)) {\n        await new Promise(resolve => setTimeout(resolve, 100));\n        controller.enqueue(new TextEncoder().encode(chunk));\n      }\n      controller.close();\n    }\n  });\n}\n\n@Component({\n  selector: 'nx-demo-x-stream-custom-protocol',\n  imports: [NzButtonModule, NzSplitterModule, NxThoughtChainModule],\n  template: `\n    <nz-splitter>\n      <nz-splitter-panel>\n        <button nz-button nzType=\"primary\" (click)=\"readStream()\">Mock Default Protocol - SSE</button>\n      </nz-splitter-panel>\n      <nz-splitter-panel>\n        <nx-thought-chain [style.margin-inline-start.px]=\"16\" [nxItems]=\"items()\" />\n      </nz-splitter-panel>\n    </nz-splitter>\n\n    <ng-template #thoughtChainCard>\n      <pre>\n        <code>{{ content() }}</code>\n      </pre>\n    </ng-template>\n  `\n})\nexport class NxDemoXStreamCustomProtocolComponent {\n  readonly thoughtChainCard = viewChild('thoughtChainCard', { read: TemplateRef });\n  readonly lines = signal<string[]>([]);\n  readonly content = linkedSignal({\n    source: this.lines,\n    computation: lines => lines.join('')\n  });\n  readonly items = computed<NxThoughtChainItem[]>(() =>\n    this.lines().length\n      ? [\n          {\n            title: 'Mock Custom Protocol - Log',\n            status: 'success',\n            icon: 'tags',\n            content: this.thoughtChainCard()\n          }\n        ]\n      : []\n  );\n\n  readStream(): void {\n    fromXStream({\n      readableStream: mockReadableStream(),\n      transformStream: new TransformStream({\n        transform(chunk, controller) {\n          controller.enqueue(chunk);\n        }\n      })\n    }).subscribe(chunk => {\n      console.log(chunk);\n      this.lines.update(pre => [...pre, chunk]);\n    });\n  }\n}\n"}
