import{a as w}from"./chunk-CODBTA5Z.js";import{a as p,c as u,h,k as m}from"./chunk-OW75ZOQB.js";var R=(e,...s)=>h(null,[e,...s],function*(d,t={}){let a=t,{fetch:o=globalThis.fetch,middlewares:i={}}=a,n=u(a,["fetch","middlewares"]);if(typeof o!="function")throw new Error("The options.fetch must be a typeof fetch function!");let r=[d,n];typeof i.onRequest=="function"&&(r=yield i.onRequest(...r));let c=yield o(...r);if(typeof i.onResponse=="function"){let f=yield i.onResponse(c);if(!(f instanceof Response))throw new Error("The options.onResponse must return a Response instance!");c=f}if(!c.ok)throw new Error(`Fetch failed with status ${c.status}`);if(!c.body)throw new Error("The response body is empty.");return c}),y=class d{baseURL;model;defaultHeaders;customOptions;constructor(t){let n=t,{baseURL:e,model:s,dangerouslyApiKey:o}=n,i=u(n,["baseURL","model","dangerouslyApiKey"]);this.baseURL=e,this.model=s,this.defaultHeaders=p({"Content-Type":"application/json"},o&&{Authorization:o}),this.customOptions=i}static init(t){if(!t.baseURL||typeof t.baseURL!="string")throw new Error("The baseURL is not valid!");return new d(t)}create=(t,e,s)=>h(this,null,function*(){let o=new AbortController,i={method:"POST",body:JSON.stringify(p({model:this.model},t)),headers:this.defaultHeaders,signal:o.signal};e?.onStream?.(o);try{let n=yield R(this.baseURL,p({fetch:this.customOptions.fetch},i));if(s){yield this.customResponseHandler(n,e,s);return}let r=n.headers.get("content-type")||"";switch(r.split(";")[0].trim()){case"text/event-stream":yield this.sseResponseHandler(n,e);break;case"application/json":yield this.jsonResponseHandler(n,e);break;default:throw new Error(`The response content-type: ${r} is not support!`)}}catch(n){let r=n instanceof Error?n:new Error("Unknown error!");throw e?.onError?.(r),r}});customResponseHandler=(t,e,s)=>h(null,null,function*(){let o=[];try{for(var i=m(w({readableStream:t.body,transformStream:s})),n,r,c;n=!(r=yield i.next()).done;n=!1){let a=r.value;o.push(a),e?.onUpdate?.(a)}}catch{c=[r]}finally{try{n&&(r=i.return)&&(yield r.call(i))}finally{if(c)throw c[0]}}e?.onSuccess?.(o)});sseResponseHandler=(t,e)=>h(null,null,function*(){let s=[],o=w({readableStream:t.body});try{for(var i=m(o),n,r,c;n=!(r=yield i.next()).done;n=!1){let a=r.value;s.push(a),e?.onUpdate?.(a)}}catch{c=[r]}finally{try{n&&(r=i.return)&&(yield r.call(i))}finally{if(c)throw c[0]}}e?.onSuccess?.(s)});jsonResponseHandler=(t,e)=>h(null,null,function*(){let s=yield t.json();e?.onUpdate?.(s),e?.onSuccess?.([s])})},b=y.init;export{b as a};
